<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Statistical Data Exploration using Spark 2.0 - Part 1 : Five Number Summary</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Thoughts on technology, life and everything else.">
    <link rel="canonical" href="http://blog.madhukaraphatak.com/statistical-data-exploration-spark-part-1">
     <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Open+Sans">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/main.css">
    <link rel="stylesheet" href="/css/app.css">
       
</head>


    <body>

    <header >
  <div class="wrap">
    <a class="site-title" href="/">Madhukar's Blog</a>  
    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
           viewBox="0 0 18 15" enable-background="new 0 0 18 15" xml:space="preserve">
          <path fill="#505050" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0
            h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#505050" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484
            h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#505050" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0
            c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>
      <div class="trigger">        
          <a class="page-link" href="http://www.madhukaraphatak.com">About me</a>                  
      </div>
    </nav>  
  </div>
</header>


    <div class="page-content">
      <div class="wrap">
      <div class="post">
 <header class="post-header">
  <h1>Statistical Data Exploration using Spark 2.0 - Part 1 : Five Number Summary</h1>
  <p class="meta">Oct 21, 2016</p>
  <div class="catagories">
    
    <a href="/categories/scala"><span class="category">scala</span></a>
    
    <a href="/categories/spark"><span class="category">spark</span></a>
    
    <a href="/categories/statistical-data-exploration"><span class="category">statistical-data-exploration</span></a>
    
  </div>
</header> 

<article class="post-content">
  <p>Data exploration is an important part of data analysis to understand nature of data. Data scientists use various mathematical and statistics techniques to understand the distribution and shape of the data which comes handy to draw conclusions.</p>

<p>Recently I started going through the coursera course “Making Sense of Data” videos to understand the data exploration techniques. Its an excellent course which explains all the basics of theory and practical aspects of data exploration. Currently the course is not available at the coursera. But you can find recording of earlier course on <a href="https://www.youtube.com/watch?v=rXZD3yVFN9w&amp;list=PL7wD1yDs0UYYmTGN3ZJnZuwloaoEuHvmE">youtube</a>.</p>

<p>Most of the examples of course are explained using R programming language. As Spark 2.0 and R share dataframe as common abstraction, I thought it will be interesting to explore possibility of using Spark dataframe/datasets abstractions to do explore the data.</p>

<p>This series of blog posts are focused  on the data exploration using spark. I will be comparing the R dataframe capabilities with spark ones. I will be using Spark 2.0 version with Scala API and Zeppelin notebooks for visualizations.This is the first blog in series where we will be discussing how to derive summary statistics of a dataset. You can find all other blogs in the series <a href="/categories/statistical-data-exploration">here</a>.</p>

<p>TL;DR All code examples available on <a href="https://github.com/phatak-dev/Statistical-Data-Exploration-Using-Spark-2.0">github</a>.</p>

<h2 id="loading-dataset">Loading Dataset</h2>
<p>For our example, we will be using life expectancy dataset. This is a dataset which has average life expectancy of all countries across the world. Its space separated file with following three fields.</p>

<ul>
  <li>Country</li>
  <li>Life Expectancy</li>
  <li>Region</li>
</ul>

<p>The below code shows to how to read the data in R</p>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">df</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.table</span><span class="p">(</span><span class="s2">"LifeExpentancy.txt"</span><span class="p">)</span><span class="w">
</span><span class="n">colnames</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"Country"</span><span class="p">,</span><span class="s2">"LifeExp"</span><span class="p">,</span><span class="s2">"Region"</span><span class="p">)</span></code></pre></div>

<p>We can load the same data in spark as below</p>

<div class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">val</span> <span class="n">rawDF</span> <span class="k">=</span> <span class="n">sparkSession</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">format</span><span class="o">(</span><span class="s">"csv"</span><span class="o">).</span><span class="n">option</span><span class="o">(</span><span class="s">"delimiter"</span><span class="o">,</span><span class="s">" "</span><span class="o">).</span>
   <span class="n">option</span><span class="o">(</span><span class="s">"inferSchema"</span><span class="o">,</span><span class="s">"true"</span><span class="o">).</span><span class="n">load</span><span class="o">(</span><span class="s">"src/main/resources/LifeExpentancy.txt"</span><span class="o">)</span>
   <span class="c1">//only extract the values we need
</span>   <span class="k">val</span> <span class="n">schema</span> <span class="k">=</span> <span class="nc">StructType</span><span class="o">(</span><span class="nc">Array</span><span class="o">(</span>
           <span class="nc">StructField</span><span class="o">(</span><span class="s">"Country"</span><span class="o">,</span><span class="nc">StringType</span><span class="o">),</span>
           <span class="nc">StructField</span><span class="o">(</span><span class="s">"LifeExp"</span><span class="o">,</span><span class="nc">DoubleType</span><span class="o">),</span>
           <span class="nc">StructField</span><span class="o">(</span><span class="s">"Region"</span><span class="o">,</span><span class="nc">StringType</span><span class="o">)</span>
   <span class="o">))</span>
   <span class="k">val</span> <span class="n">selectedDF</span> <span class="k">=</span> <span class="n">rawDF</span><span class="o">.</span><span class="n">select</span><span class="o">(</span><span class="s">"_c0"</span><span class="o">,</span><span class="s">"_c2"</span><span class="o">,</span><span class="s">"_c4"</span><span class="o">)</span>
   <span class="k">val</span> <span class="n">lifeExpectancyDF</span> <span class="k">=</span> <span class="n">sparkSession</span><span class="o">.</span><span class="n">createDataFrame</span><span class="o">(</span><span class="n">selectedDF</span><span class="o">.</span><span class="n">rdd</span><span class="o">,</span><span class="n">schema</span><span class="o">)</span>
   <span class="n">lifeExpectancyDF</span>
 <span class="o">}</span></code></pre></div>

<p>We have to do little bit more work in spark as spark-csv package doesn’t handle double spaces properly.</p>

<p>Now we have data ready to explore.</p>

<h2 id="five-number-summary">Five Number Summary</h2>

<p>Five number summary is one of the basic data exploration technique where we will find how values of dataset columns are distributed. In our example, we are interested to know the summary of “LifeExp” column.</p>

<p>Five Number Summary Contains following information</p>

<ul>
  <li>Min - Minimum value of the column</li>
  <li>First Quantile - The 25% th data</li>
  <li>Median - Middle Value</li>
  <li>Third Quartile - 75% of the value</li>
  <li>Max - maximum value</li>
</ul>

<p>The above values gives a fair idea about how the values are distributed for the column. For categorical columns it will be different. We will discuss about that in future blogs.</p>

<p>The below code in R allows to compute above values</p>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">attach</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="w">
</span><span class="n">summary</span><span class="p">(</span><span class="n">LifeExp</span><span class="p">)</span></code></pre></div>

<p>We get below result</p>

<div class="highlight"><pre><code class="language-text" data-lang="text">Min. 1st Qu.  Median    Mean 3rd Qu.    Max.
  47.79   64.67   73.24   69.86   76.65   83.39</code></pre></div>

<p>R shows mean also as part of the summary.</p>

<h2 id="five-number-summary-in-spark">Five Number Summary in Spark</h2>

<p>In Spark, we can get same information using <em>describe</em> method.</p>

<div class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="n">lifeExpectancyDF</span><span class="o">.</span><span class="n">describe</span><span class="o">(</span><span class="s">"LifeExp"</span><span class="o">).</span><span class="n">show</span><span class="o">()</span></code></pre></div>

<p>The below is the output</p>

<div class="highlight"><pre><code class="language-text" data-lang="text">+-------+-----------------+
|summary|          LifeExp|
+-------+-----------------+
|  count|              197|
|   mean|69.86281725888323|
| stddev|9.668736205594511|
|    min|           47.794|
|    max|           83.394|
+-------+-----------------+</code></pre></div>

<p>If you observe the result, rather than giving quantiles values and median, spark gives standard deviation. The reason is, median and quantiles are costly to compute on large data. Both values need data to be in sorted order and result in skewed calculations.</p>

<h2 id="calculating-quantiles-in-spark">Calculating Quantiles in Spark</h2>

<p>We can calculate quartiles using <em>approxQuantile</em> method introduced in spark 2.0. This allows us to find 25%, median and 75% values like R. The name of the method suggests that we can get approximate values whenever we specify the error rate. This makes calculations much faster compared to absolute value.</p>

<p>In our example we will be calculating the exact values so that we can compare to R.</p>

<div class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">val</span> <span class="n">medianAndQuantiles</span> <span class="k">=</span> <span class="n">lifeExpectancyDF</span><span class="o">.</span><span class="n">stat</span><span class="o">.</span><span class="n">approxQuantile</span><span class="o">(</span><span class="s">"LifeExp"</span><span class="o">,</span>
           <span class="nc">Array</span><span class="o">(</span><span class="mf">0.25</span><span class="o">,</span><span class="mf">0.5</span><span class="o">,</span><span class="mf">0.75</span><span class="o">),</span><span class="mf">0.0</span><span class="o">)</span></code></pre></div>

<p>In above code, the below are the parameter to <em>approxQuantile</em> method</p>

<ul>
  <li>Name of the column</li>
  <li>
    <p>Array of values signifying which quantile we want. In our example we are calculating 25%, 50% and 75%. 50% is same as median</p>
  </li>
  <li>The last parameter signifies the error rate. 0.0 signifies we want exact value.</li>
</ul>

<p>The below is the result</p>

<div class="highlight"><pre><code class="language-text" data-lang="text">List(64.986, 73.339, 76.835)</code></pre></div>

<p>If you compare the result, it matches with the R values.</p>

<p>You can access complete code on <a href="https://github.com/phatak-dev/Statistical-Data-Exploration-Using-Spark-2.0/blob/master/src/main/scala/com/madhukaraphatak/spark/dataexploration/SummaryExample.scala">github</a>.</p>

<h2 id="conclusion">Conclusion</h2>

<p>In this post we discussed how to get started with exploring data using statistics in spark 2.0. In future blogs we will discuss further more techniques and API’s.</p>

</article>
<div class="related">
  <h2>Related posts</h2>
  <ul>
    
             
    
    <li>    
     <span class="post-date">01 Apr 2020</span>
     &raquo; <a href="/spark-3-datasource-v2-part-5">Data Source V2 API in Spark 3.0 - Part 5 : Anatomy of V2 Write API</a>    
   </li>           
         

            
    
    <li>    
     <span class="post-date">31 Mar 2020</span>
     &raquo; <a href="/spark-3-introduction-part-3">Introduction to Spark 3.0 - Part 3 : Data Loading From Nested Folders</a>    
   </li>           
         

            
    
    <li>    
     <span class="post-date">30 Mar 2020</span>
     &raquo; <a href="/spark-3-introduction-part-2">Introduction to Spark 3.0 - Part 2 : Multiple Column Feature Transformations in Spark ML</a>    
   </li>           
         

   
   
             
    
    <li>    
     <span class="post-date">01 Apr 2020</span>
     &raquo; <a href="/spark-3-datasource-v2-part-5">Data Source V2 API in Spark 3.0 - Part 5 : Anatomy of V2 Write API</a>    
   </li>           
         

            
    
    <li>    
     <span class="post-date">31 Mar 2020</span>
     &raquo; <a href="/spark-3-introduction-part-3">Introduction to Spark 3.0 - Part 3 : Data Loading From Nested Folders</a>    
   </li>           
         

            
    
    <li>    
     <span class="post-date">30 Mar 2020</span>
     &raquo; <a href="/spark-3-introduction-part-2">Introduction to Spark 3.0 - Part 2 : Multiple Column Feature Transformations in Spark ML</a>    
   </li>           
         

   
   
 </ul>


 
<!--     
    <div id="disqus_thread" style="padding-top:4%;"></div>
     <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'personalblogmadhukar'; // required: replace example with your forum shortname
        var disqus_developer = 1;

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
   
</div> -->

      </div>
    </div>

    <footer class="site-footer">

  <div class="wrap">   
    <div class="footer-col-1 column">
      <ul>
        <li>
          <a href="https://github.com/phatak-dev">
            <span class="icon github">
              <svg version="1.1" class="github-icon-svg" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
                 viewBox="0 0 16 16" enable-background="new 0 0 16 16" xml:space="preserve">
                <path fill-rule="evenodd" clip-rule="evenodd" fill="#C2C2C2" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761
                c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32
                c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472
                c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037
                C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65
                c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261
                c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082
                c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129
                c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/>
              </svg>
            </span>
            <span class="username">phatak-dev</span>
          </a>
        </li>
        <li>
          <a href="https://twitter.com/madhukaraphatak">
            <span class="icon twitter">
              <svg version="1.1" class="twitter-icon-svg" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
                 viewBox="0 0 16 16" enable-background="new 0 0 16 16" xml:space="preserve">
                <path fill="#C2C2C2" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809
                c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27
                c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767
                c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206
                C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271
                c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469
                c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/>
              </svg>
            </span>
            <span class="username">madhukaraphatak</span>
          </a>
        </li>
      </ul>
    </div>

    <div class="footer-col-3 column">
      <p class="text">Thoughts on technology, life and everything else.</p>
    </div>

    <div style="float:right;">
      <a href="/feed.xml"><img src="/images/rss.png">
    </div>



  </div>

</footer>

    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-52311191-1', 'auto');
  ga('send', 'pageview');

</script>

    </body>
</html>